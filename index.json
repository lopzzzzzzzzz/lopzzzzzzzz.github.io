[{"content":"é•œåƒåŠ é€Ÿ https://cr.console.aliyun.com/?spm=a2c4g.60750.0.0.19e6296aU86EO3\né˜¿é‡Œäº‘æœ‰å›½å†…çš„é•œåƒåŠ é€ŸèŠ‚ç‚¹ï¼Œç™»é™†å®Œæ·»åŠ èŠ‚ç‚¹å³å¯ã€‚\né•œåƒç›¸å…³ æ‹‰å–é•œåƒ å‘½ä»¤ï¼šdocker pull é•œåƒåç§°\nä¸æŒ‡å®šç‰ˆæœ¬é»˜è®¤æ˜¯latestï¼Œå³æœ€æ–°ç‰ˆæœ¬\nå¦‚docker pull tomcat:8.0\næŸ¥çœ‹é•œåƒ å‘½ä»¤ï¼šdocker images æˆ– docker image ls\ndocker images -q é•œåƒåï¼šè¿”å›è¿™ä¸ªé•œåƒçš„æ‰€æœ‰ç‰ˆæœ¬çš„idï¼Œä¸åŠ é•œåƒååˆ™è¿”å›æ•´ä¸ªæœ¬åœ°ä»“åº“çš„æ‰€æœ‰é•œåƒ\nåˆ é™¤é•œåƒ docker image rm é•œåƒå:ç‰ˆæœ¬(æˆ–è€…id) ï¼šéå¼ºåˆ¶åˆ é™¤ï¼Œè‹¥å¯¹åº”é•œåƒçš„å®¹å™¨æ­£åœ¨è¿è¡Œï¼Œåˆ™æ— æ³•åˆ é™¤\ndocker image rm -f é•œåƒå:ç‰ˆæœ¬(æˆ–è€…id)ï¼šå¼ºåˆ¶åˆ é™¤ï¼Œæ— è®ºå®¹å™¨æ˜¯å¦åœ¨è¿è¡Œ\ndocker image rm -f $(docker image -q)ï¼šåˆ åº“è·‘è·¯ğŸŒš\nå®¹å™¨ç›¸å…³ è¿è¡Œå®¹å™¨ docker run -d --name tomcat01 -p 8081:8080 tomcat:8.0\n-d ï¼šä½œä¸ºå®ˆæŠ¤è¿›ç¨‹åå°å¯åŠ¨\n--name ï¼šæŒ‡å®šåå­—ï¼ˆå”¯ä¸€ï¼‰\n-p ï¼šå®¿ä¸»æœºå’Œå®¹å™¨çš„ç«¯å£æ˜ å°„ï¼Œåœ¨è¿™é‡Œæ˜¯å°†å®¿ä¸»æœºçš„8081ç«¯å£æ˜ å°„å®¹å™¨çš„8080ç«¯å£ï¼Œé€šè¿‡127.0.0.1:8081å³å¯è®¿é—®tomcatæœåŠ¡äº†ã€‚\ntomcat:8.0 ï¼šæŒ‡å®šå®¹å™¨é•œåƒ\næŸ¥çœ‹å®¹å™¨ docker ps ï¼šæŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨\ndocker ps -a ï¼šæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å…³é—­çš„æš‚åœçš„ï¼‰\ndocker ps -q ï¼šä»¥idæ–¹å¼æŸ¥çœ‹æ‰€æœ‰æ­£åœ¨è¿è¡Œå®¹å™¨\nåœæ­¢ï½œå¼€å¯ï½œé‡å¯ï½œæš‚åœï½œæ¢å¤å®¹å™¨ docker stop å®¹å™¨åå­—æˆ–id ï¼šåœæ­¢\ndocker start å®¹å™¨åå­—æˆ–id ï¼šå¼€å¯\ndocker restart å®¹å™¨åå­—æˆ–id ï¼šé‡å¯\ndocker pause|unpause å®¹å™¨åå­—æˆ–id ï¼šæš‚åœï½œæ¢å¤å®¹å™¨\nåˆ é™¤å®¹å™¨ docker rm å®¹å™¨åå­—æˆ–id ï¼šåˆ é™¤å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨\ndocker rm -f å®¹å™¨åå­—æˆ–id ï¼šå¼ºåˆ¶åˆ é™¤å®¹å™¨\næŸ¥çœ‹å®¹å™¨å†…éƒ¨æ—¥å¿— docker logs å®¹å™¨åå­—æˆ–id ï¼šæŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼ŒåŠ å‚æ•°-få®æ—¶æ›´æ–°\nä¸å®¹å™¨äº¤äº’ docker exec -it å®¹å™¨åå­—æˆ–id bash ï¼šè¿›å…¥å®¹å™¨æ‰€åœ¨çš„osè¿›è¡Œäº¤äº’ï¼Œexité€€å‡º\nå®¹å™¨ä¸å®¿ä¸»æœºæ‹·è´æ–‡ä»¶ docker cp å®¹å™¨åå­—æˆ–id:ç›®å½• å®¿ä¸»æœºç›®å½• ï¼šæ‹·è´æ–‡ä»¶ï¼Œå†™åœ¨å‰é¢çš„ç›®å½•æ–‡ä»¶æ‹·è´åˆ°åé¢çš„\nå¦‚docker cp tomcat01:/usr/local/tomcat /root/cpï¼Œå°†å®¹å™¨çš„tomcatç›®å½•å¤åˆ¶åˆ°ä¸»æœºcpç›®å½•ä¸‹\næŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹ docker top å®¹å™¨åå­—æˆ–id\næŸ¥çœ‹å®¹å™¨ç»†èŠ‚ docker inspect å®¹å™¨åå­—æˆ–id\nå®¹å™¨æ•°æ®å· æ•°æ®å·å°±æ˜¯æŒ‡å®šå®¿ä¸»æœºå’Œå®¹å™¨çš„ç›®å½•è¿›è¡ŒåŒå‘æ˜ å°„ï¼Œå°±å¯ä»¥é€šè¿‡ä¿®æ”¹å®¿ä¸»æœºæˆ–å®¹å™¨çš„æ–‡ä»¶è¿›è¡Œäº’ç›¸å½±å“ã€‚\né…ç½®æ–‡ä»¶éœ€è¦é¢‘ç¹ä¿®æ”¹ å®¹å™¨å†…éƒ¨çš„æ•°æ®éœ€è¦å¤‡ä»½ åˆ é™¤å®¹å™¨ä¸å¸Œæœ›åˆ é™¤æ•°æ® ä»¥ä¸Šåœºæ™¯å¤§æ¦‚ç‡éœ€è¦ä½¿ç”¨æ•°æ®å·ã€‚\næ•°æ®å·åªèƒ½åœ¨dockerå®¹å™¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶æŒ‡å®šã€‚\ndocker run -v /root/aaa:/usr/local/tomcat/webapps tomcat:8.0 ï¼Œè¿™æ ·ä¾¿å®ç°äº†å®¿ä¸»æœºçš„aaaç›®å½•å’Œå®¹å™¨å†…çš„webappsç›®å½•çš„åŒå‘æ˜ å°„ï¼Œåœ¨ä»»æ„ä¸€è¾¹ç›®å½•ä¸‹ä»»æ„åˆ›å»ºæ–‡ä»¶ï¼Œå¦ä¸€è¾¹éƒ½ä¼šè¿›è¡ŒåŒæ­¥ã€‚\nä¸ºäº†ä¿æŒåŒæ­¥ï¼Œå®¹å™¨å¯¹åº”çš„ç›®å½•ä¸‹ä¼šå¼ºåˆ¶åŒæ­¥æˆå®¿ä¸»æœºç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´webappsä¸‹ä¼šæ¸…ç©ºaaaç›®å½•ä¸‹ä¸å­˜åœ¨çš„æ–‡ä»¶ç›®å½•ï¼Œåªä¿ç•™å’Œaaaç›®å½•ä¸€æ ·çš„æ–‡ä»¶ç›®å½•ã€‚\ndocker run -v abc:/usr/local/tomcat/webapps tomcat:8.0 ï¼Œåˆ«åè®¾ç½®æ•°æ®å·ï¼Œè¿™ç§æ–¹å¼ä¸ä¼šæ¸…ç©ºwebappsä¸‹çš„ç›®å½•ï¼Œä¸”ç›®å½•é»˜è®¤åˆ›å»ºåœ¨/var/lib/docker/volumes/ä¸‹ã€‚\nå®¹å™¨æ‰“åŒ…æˆé•œåƒ docker commit -m \u0026quot;messgae\u0026quot; -a \u0026quot;author\u0026quot; å®¹å™¨åå­—æˆ–id é•œåƒå:ç‰ˆæœ¬\nå®¹å™¨å¤‡ä»½ä¸æ¢å¤ å¤‡ä»½å¦‚ï¼šdocker save tomcat:8.0 -o tomcat-8.0.tar\næ¢å¤å¦‚ï¼šdocker load -i tomcat-8.0.tar\n","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/docker/","summary":"é•œåƒåŠ é€Ÿ https://cr.console.aliyun.com/?spm=a2c4g.60750.0.0.19e6296aU86EO3 é˜¿é‡Œäº‘æœ‰å›½å†…çš„é•œåƒåŠ é€ŸèŠ‚ç‚¹ï¼Œç™»é™†å®Œæ·»åŠ èŠ‚ç‚¹å³å¯ã€‚ é•œåƒç›¸å…³ æ‹‰å–é•œåƒ å‘½ä»¤ï¼šdocker pull é•œåƒåç§° ä¸æŒ‡å®šç‰ˆæœ¬é»˜è®¤æ˜¯latestï¼Œå³æœ€æ–°ç‰ˆ","title":"Docker"},{"content":"JWT jwtï¼Œå³json-web-tokenï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„è®¤è¯çš„ä»¤ç‰Œï¼Œé€šå¸¸ç”¨äºèº«ä»½è®¤è¯å’Œæˆæƒã€‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPayloadï¼‰å’Œç­¾åï¼ˆSignatureï¼‰ã€‚\nå¤´éƒ¨ï¼ˆHeaderï¼‰ï¼šJWT çš„å¤´éƒ¨åŒ…å«äº†ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼šä»¤ç‰Œç±»å‹ï¼ˆtypï¼‰å’Œç­¾åç®—æ³•ï¼ˆalgï¼‰ï¼Œç”¨ Base64 ç¼–ç åçš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ è½½è·ï¼ˆPayloadï¼‰ï¼šJWT çš„è½½è·åŒ…å«äº†ä¸€äº›å£°æ˜ï¼ˆClaimsï¼‰ï¼Œç”¨æ¥è¡¨ç¤ºä¸€äº›å®ä½“ï¼ˆä¸»é¢˜ã€å‘è¡Œè€…ã€è¿‡æœŸæ—¶é—´ç­‰ï¼‰å’Œä¸€äº›å…ƒæ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè½½è·ä¸­çš„ä¿¡æ¯æ˜¯å¯ä»¥è¢«è§£ç çš„ï¼Œå› æ­¤ä¸è¦åœ¨ JWT ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ã€‚ ç­¾åï¼ˆSignatureï¼‰ï¼šJWT çš„ç­¾åç”¨äºéªŒè¯æ¶ˆæ¯çš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚ç­¾åçš„è¿‡ç¨‹éœ€è¦ä½¿ç”¨å¤´éƒ¨å’Œè½½è·ä¸­çš„ä¿¡æ¯ï¼Œä»¥åŠä¸€ä¸ªç§˜é’¥ï¼Œç„¶åé€šè¿‡æŒ‡å®šçš„ç®—æ³•è¿›è¡Œç­¾åã€‚ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyaWQiOjEzMzA4MDgxNTYyMDg1Mzc2MCwidXNlcm5hbWUiOiJ3d3ciLCJleHAiOjE2ODcwOTgxNzksImlzcyI6IndlYi1hcHAifQ.29KktS5R7sZt_K23CfAElgusmrHw8rbsp8ftKoVkWsc\nè¿™æ˜¯ä¸€ä¸ªtokenï¼Œåˆ†ä¸º3æ®µï¼Œæ¯ä¸€æ®µéƒ½è¢«.éš”å¼€ï¼Œå‰ä¸¤æ®µåˆ†åˆ«ç”±å¤´éƒ¨å’Œè½½è·Base64URLè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç”±.è¿æ¥èµ·æ¥ï¼Œæœ€åä½¿ç”¨ç‰¹å®šç®—æ³•å¯¹å‰2æ®µå’Œä¸€ä¸ªç‰¹å®šçš„secretæ‹¼å‡‘èµ·æ¥åŠ å¯†ã€‚\n1 HMACSHA256( base64UrlEncode(header) + \u0026#34;.\u0026#34; +base64UrlEncode(payload), secret) å¦‚ä¸‹å›¾æ˜¯ä¸Šé¢tokençš„ä¸€ä¸ªè§£å¯†ã€‚\nä½¿ç”¨jwtå®Œæˆç™»é™†è®¤è¯ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 //tokençš„ç”Ÿæˆä¸è§£æ package auth import ( \u0026#34;errors\u0026#34; \u0026#34;github.com/dgrijalva/jwt-go\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;time\u0026#34; ) //ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯jwtä¸­å¯¹åº”çš„payloadï¼Œå¯ä»¥è‡ªå®šä¹‰ type MyClaim struct { Userid int64 `json:\u0026#34;userid\u0026#34;` Username string `json:\u0026#34;username\u0026#34;` jwt.StandardClaims } //secret var CustomSecret = []byte(\u0026#34;happy\u0026#34;) var InvalidToken = errors.New(\u0026#34;invalid token\u0026#34;) //ç”Ÿæˆtoken func GetToken(username string, userid int64) (string, error) { //æ ¹æ®é…ç½®æ–‡ä»¶è·å–tokençš„è¿‡æœŸæ—¶é—´ TokenExpireDuration := viper.GetInt64(\u0026#34;jwt.tokenExpire\u0026#34;) mc := \u0026amp;MyClaim{ Userid: userid, Username: username, StandardClaims: jwt.StandardClaims{ Issuer: \u0026#34;web-app\u0026#34;, //è®¾ç½®è¿‡æœŸæ—¶é—´ ExpiresAt: time.Now().Add(time.Duration(TokenExpireDuration)).Unix(), }, } //ä½¿ç”¨HS256åŠ å¯†ç®—æ³• token := jwt.NewWithClaims(jwt.SigningMethodHS256, mc) return token.SignedString(CustomSecret) } // è§£ætoken func ParseToken(tokenString string) (*MyClaim, error) { mc := new(MyClaim) token, err := jwt.ParseWithClaims(tokenString, mc, func(token *jwt.Token) (interface{}, error) { return CustomSecret, nil }) if err != nil { return nil, err } if token.Valid { return mc, nil } return nil, InvalidToken } å®Œæˆjwtçš„ç”Ÿæˆè§£æåï¼Œå°±å¯ä»¥å†™ä¸­é—´ä»¶äº†ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 package middlewares import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;web_app/controller\u0026#34; \u0026#34;web_app/dao/redis\u0026#34; \u0026#34;web_app/utils/auth\u0026#34; ) var CtxUserIDKey = \u0026#34;userId\u0026#34; func JWTAuthMiddleware(c *gin.Context) { //ä»è¯·æ±‚å¤´æ‹¿å‡ºtokenï¼Œtokenä¸ä¸€å®šåœ¨è¿™é‡Œï¼Œéœ€è¦å’Œå‰ç«¯ååŒ authHeader := c.Request.Header.Get(\u0026#34;Authorization\u0026#34;) if authHeader == \u0026#34;\u0026#34; { //è‡ªå®šä¹‰çš„è¿”å›æ–¹æ³• controller.ResponseError(c, controller.CodeNeedLogin) c.Abort() return } part := strings.SplitN(authHeader, \u0026#34; \u0026#34;, 2) if len(part) != 2 || part[0] != \u0026#34;Bearer\u0026#34; { controller.ResponseError(c, controller.CodeInvalidToken) c.Abort() return } mc, err := auth.ParseToken(part[1]) if err != nil { controller.ResponseError(c, controller.CodeInvalidToken) c.Abort() return } //æ¯æ¬¡è¯·æ±‚éƒ½å¯ä»¥è§£æå‡ºuserä¿¡æ¯ï¼Œå¯ä»¥è¾¨åˆ«æ˜¯å“ªä¸ªç”¨æˆ· c.Set(CtxUserIDKey, mc.Userid) c.Next() } é™åˆ¶ä¸€ä¸ªè®¾å¤‡ç™»é™† è¿™é‡Œç”¨çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨redis+jwtï¼Œæ¯æ¬¡ç™»é™†å®Œï¼Œå°†ç”¨æˆ·çš„usernameå’Œtokenå­˜åˆ°redisä¸­ï¼Œå¦‚æœæœ‰æ–°çš„ç™»é™†ï¼Œå°†ä¼šè¦†ç›–åŸæ¥çš„tokenã€‚å½“ç”¨æˆ·åœ¨Aç«¯ç¬¬ä¸€æ¬¡ç™»é™†åï¼Œç”Ÿæˆçš„tokenä¼šå­˜åˆ°redisä¸­è¿”å›ç»™ç”¨æˆ·ï¼Œç”¨æˆ·æ‹¿ç€è¿™ä¸ªtokenæ¥è®¿é—®ç‰¹å®šçš„èµ„æºæ—¶ï¼Œä¼šå’Œredisä¸­çš„tokenè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸€è‡´ï¼Œæ‰å…è®¸æ”¾è¡Œã€‚è€Œå¦‚æœåœ¨ç”¨æˆ·åœ¨Bç«¯åˆè¿›è¡Œäº†ç™»é™†ï¼Œé‚£ä¹ˆæ–°çš„tokenå°†ä¼šè¦†ç›–æ—§çš„tokenï¼Œå½“ç”¨æˆ·åœ¨Aç«¯æ‹¿ç€æ—§çš„tokenæ¥è®¿é—®æ—¶ï¼Œä¸redisä¸­çš„tokenæ˜æ˜¾ä¸ä¸€è‡´ï¼Œæ­¤æ—¶ä¼šæ‹’ç»è®¿é—®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 package redis import ( \u0026#34;context\u0026#34; \u0026#34;errors\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/go-redis/redis/v8\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; \u0026#34;time\u0026#34; ) var NotExistToken = errors.New(\u0026#34;ä¸å­˜åœ¨çš„key\u0026#34;) //å­˜redis func StorgeUserIdToken(token, username string) (err error) { ctx := context.Background() //åŒæ ·è·å–tokenå­˜æ´»æ—¶é—´ï¼Œå°†redisçš„tokenæ—¶é—´è®¾ä¸ºä¸€è‡´ duration := time.Duration(viper.GetInt(\u0026#34;jwt.tokenExpire\u0026#34;)) //å­˜è¿›redis if err = rdb.Set(ctx, username, token, duration).Err(); err != nil { zap.L().Error(\u0026#34;insert username into redis error\u0026#34;, zap.Error(err)) fmt.Printf(\u0026#34;insert username into redis error:%v\\n\u0026#34;, err) } return } //ä»rediså–token func GetJwtToken(username string) (token string, err error) { ctx := context.Background() token, err = rdb.Get(ctx, username).Result() if err == redis.Nil { return \u0026#34;\u0026#34;, NotExistToken } if err != nil { zap.L().Error(\u0026#34;search redis error\u0026#34;, zap.Error(err)) return } return } ç„¶ååœ¨åˆšåˆšçš„ä¸­é—´ä»¶åŠ ä¸Šä»¥ä¸‹ä»£ç \n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 //è·å–token token, err := redis.GetJwtToken(mc.Username) //å¦‚æœtokenä¸å­˜åœ¨ï¼Œåˆ¤å®šéœ€è¦ç™»é™† if err == redis.NotExistToken { controller.ResponseError(c, controller.CodeNeedLogin) c.Abort() return } //æ¯”è¾ƒtokenï¼Œä¸ä¸€è‡´åˆ™åˆ¤å®šå·²åœ¨å¦ä¸€ç«¯ç™»é™† if part[1] != token { controller.ResponseError(c, controller.CodelimitLogin) c.Abort() return } c.Set(CtxUserIDKey, mc.Userid) c.Next() æ•ˆæœ ç™»é™†\nç™»é™†æˆåŠŸåï¼Œå¤åˆ¶åˆšåˆšçš„tokenå»è®¿é—®\né‡æ–°å‘èµ·ä¸€ä¸ªç™»é™†è¯·æ±‚\nä»æ˜¯ç¬¬ä¸€æ¬¡ç™»é™†çš„tokenå»è®¿é—®\n","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/jwt%E9%99%90%E5%88%B6%E4%B8%80%E4%B8%AA%E8%AE%BE%E5%A4%87%E7%99%BB%E9%99%86/","summary":"JWT jwtï¼Œå³json-web-tokenï¼Œæ˜¯ä¸€ç§è½»é‡çº§çš„è®¤è¯çš„ä»¤ç‰Œï¼Œé€šå¸¸ç”¨äºèº«ä»½è®¤è¯å’Œæˆæƒã€‚ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå¤´éƒ¨ï¼ˆHeaderï¼‰ã€è½½è·ï¼ˆPay","title":"Go-Jwtç™»é™†ï¼Œä»¥åŠé™åˆ¶ä¸€ä¸ªè®¾å¤‡ç™»é™†"},{"content":"è„šæ‰‹æ¶æœ‰ä»€ä¹ˆç”¨ è„šæ‰‹æ¶ï¼ˆScaffoldï¼‰æ˜¯ä¸€ç§å¿«é€Ÿæ­å»ºé¡¹ç›®çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨åŒ–ç”Ÿæˆé¡¹ç›®çš„åŸºç¡€ç»“æ„å’Œæ–‡ä»¶ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡å’Œå‡å°‘å‡ºé”™çš„å¯èƒ½æ€§ã€‚è„šæ‰‹æ¶é€šå¸¸åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ç›®å½•ç»“æ„ã€é…ç½®æ–‡ä»¶ã€æ¨¡æ¿æ–‡ä»¶ç­‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹å’Œå®šåˆ¶ã€‚ä½¿ç”¨è„šæ‰‹æ¶å¯ä»¥å¤§å¤§ç®€åŒ–é¡¹ç›®çš„æ­å»ºå’Œé…ç½®è¿‡ç¨‹ï¼Œå‡å°‘å¼€å‘äººå‘˜çš„å·¥ä½œé‡å’Œå‡ºé”™çš„å¯èƒ½æ€§ã€‚\né…ç½®Viper viper æ˜¯ Go åº”ç”¨ç¨‹åºçš„å®Œæ•´é…ç½®è§£å†³æ–¹æ¡ˆï¼Œå®ƒæ—¨åœ¨åœ¨åº”ç”¨ç¨‹åºä¸­å·¥ä½œï¼Œå¹¶ä¸”å¯ä»¥å¤„ç†æ‰€æœ‰ç±»å‹çš„é…ç½®éœ€æ±‚å’Œæ ¼å¼ã€‚\nå®‰è£…viperï¼šgo get github.com/spf13/viper\nå®‰è£…å®Œä¹‹åï¼Œåœ¨é¡¹ç›®ç›®å½•ä¸‹è®¾ç½®é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯yamlæ ¼å¼ï¼Œåˆ›å»ºconfig.yaml\nå†™å…¥ä½ éœ€è¦çš„é…ç½®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 app: name: \u0026#34;web_app\u0026#34; mode: \u0026#34;dev\u0026#34; port: 8081 log: level: \u0026#34;debug\u0026#34; filename: \u0026#34;web_app.log\u0026#34; max_size: 200 max_age: 30 max_backups: 7 mysql: host: \u0026#34;127.0.0.1\u0026#34; port: 3306 user: \u0026#34;root\u0026#34; password: \u0026#34;123456\u0026#34; dbname: \u0026#34;db_name\u0026#34; max_open_conns: 200 max_idle_conns: 50 redis: host: \u0026#34;\u0026#34; port: 6379 password: \u0026#34;\u0026#34; db: 0 pool_size: 100 åœ¨é¡¹ç›®ä¸‹åˆ›å»ºconfig/config.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 package config import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/fsnotify/fsnotify\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) func Init() (err error) { viper.SetConfigFile(\u0026#34;./config.yaml\u0026#34;) // æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ err = viper.ReadInConfig() // è¯»å–é…ç½®ä¿¡æ¯ if err != nil { fmt.Printf(\u0026#34;Read ConfigFile Error, err:%v\\n\u0026#34;, err) // è¯»å–é…ç½®ä¿¡æ¯å¤±è´¥ return err } // ç›‘æ§é…ç½®æ–‡ä»¶å˜åŒ– viper.WatchConfig() viper.OnConfigChange(func(in fsnotify.Event) { fmt.Printf(\u0026#34;ConfigFile Changed:%v\\n\u0026#34;, in.Name) }) return } é…ç½®æ—¥å¿—log goè‡ªå¸¦çš„æ—¥å¿—ä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ï¼Œä½†å®ƒç¼ºå°‘INFO/DEBUG/ERRORæ—¥å¿—çº§åˆ«ï¼Œä¸å¯ä»¥åœ¨æ­£å¸¸æƒ…å†µä¸‹è®°å½•é”™è¯¯ï¼Œåªèƒ½panicæˆ–é€€å‡ºç¨‹åºä¸‹è®°å½•ï¼Œä¹Ÿä¸èƒ½æä¾›æ—¥å¿—åˆ‡å‰²ã€‚\nå®‰è£…zapï¼šgo get -u go.uber.org/zap\nå®‰è£…lumberjackï¼šgo get gopkg.in/natefinch/lumberjack.v2\nåˆ›å»ºlogger/logger.go(ä»¥ä¸‹ä»£ç å‚è€ƒè‡ª)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 package logger import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;github.com/natefinch/lumberjack\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; \u0026#34;go.uber.org/zap/zapcore\u0026#34; \u0026#34;net\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;net/http/httputil\u0026#34; \u0026#34;os\u0026#34; \u0026#34;runtime/debug\u0026#34; \u0026#34;strings\u0026#34; \u0026#34;time\u0026#34; ) var lg *zap.Logger // InitLogger åˆå§‹åŒ–Logger func Init() (err error) { writeSyncer := getLogWriter(viper.GetString(\u0026#34;log.filename\u0026#34;), viper.GetInt(\u0026#34;log.max_size\u0026#34;), viper.GetInt(\u0026#34;log.max_backups\u0026#34;), viper.GetInt(\u0026#34;log.max_age\u0026#34;)) encoder := getEncoder() var l = new(zapcore.Level) err = l.UnmarshalText([]byte(viper.GetString(\u0026#34;log.level\u0026#34;))) if err != nil { return } core := zapcore.NewCore(encoder, writeSyncer, l) lg = zap.New(core, zap.AddCaller()) zap.ReplaceGlobals(lg) // æ›¿æ¢zapåŒ…ä¸­å…¨å±€çš„loggerå®ä¾‹ï¼Œåç»­åœ¨å…¶ä»–åŒ…ä¸­åªéœ€ä½¿ç”¨zap.L()è°ƒç”¨å³å¯ return } func getEncoder() zapcore.Encoder { encoderConfig := zap.NewProductionEncoderConfig() encoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder encoderConfig.TimeKey = \u0026#34;time\u0026#34; encoderConfig.EncodeLevel = zapcore.CapitalLevelEncoder encoderConfig.EncodeDuration = zapcore.SecondsDurationEncoder encoderConfig.EncodeCaller = zapcore.ShortCallerEncoder return zapcore.NewJSONEncoder(encoderConfig) } func getLogWriter(filename string, maxSize, maxBackup, maxAge int) zapcore.WriteSyncer { lumberJackLogger := \u0026amp;lumberjack.Logger{ Filename: filename, MaxSize: maxSize, MaxBackups: maxBackup, MaxAge: maxAge, } return zapcore.AddSync(lumberJackLogger) } // GinLogger æ¥æ”¶ginæ¡†æ¶é»˜è®¤çš„æ—¥å¿— func GinLogger() gin.HandlerFunc { return func(c *gin.Context) { start := time.Now() path := c.Request.URL.Path query := c.Request.URL.RawQuery c.Next() cost := time.Since(start) lg.Info(path, zap.Int(\u0026#34;status\u0026#34;, c.Writer.Status()), zap.String(\u0026#34;method\u0026#34;, c.Request.Method), zap.String(\u0026#34;path\u0026#34;, path), zap.String(\u0026#34;query\u0026#34;, query), zap.String(\u0026#34;ip\u0026#34;, c.ClientIP()), zap.String(\u0026#34;user-agent\u0026#34;, c.Request.UserAgent()), zap.String(\u0026#34;errors\u0026#34;, c.Errors.ByType(gin.ErrorTypePrivate).String()), zap.Duration(\u0026#34;cost\u0026#34;, cost), ) } } // GinRecovery recoveræ‰é¡¹ç›®å¯èƒ½å‡ºç°çš„panicï¼Œå¹¶ä½¿ç”¨zapè®°å½•ç›¸å…³æ—¥å¿— func GinRecovery(stack bool) gin.HandlerFunc { return func(c *gin.Context) { defer func() { if err := recover(); err != nil { // Check for a broken connection, as it is not really a // condition that warrants a panic stack trace. var brokenPipe bool if ne, ok := err.(*net.OpError); ok { if se, ok := ne.Err.(*os.SyscallError); ok { if strings.Contains(strings.ToLower(se.Error()), \u0026#34;broken pipe\u0026#34;) || strings.Contains(strings.ToLower(se.Error()), \u0026#34;connection reset by peer\u0026#34;) { brokenPipe = true } } } httpRequest, _ := httputil.DumpRequest(c.Request, false) if brokenPipe { lg.Error(c.Request.URL.Path, zap.Any(\u0026#34;error\u0026#34;, err), zap.String(\u0026#34;request\u0026#34;, string(httpRequest)), ) // If the connection is dead, we can\u0026#39;t write a status to it. c.Error(err.(error)) // nolint: errcheck c.Abort() return } if stack { lg.Error(\u0026#34;[Recovery from panic]\u0026#34;, zap.Any(\u0026#34;error\u0026#34;, err), zap.String(\u0026#34;request\u0026#34;, string(httpRequest)), zap.String(\u0026#34;stack\u0026#34;, string(debug.Stack())), ) } else { lg.Error(\u0026#34;[Recovery from panic]\u0026#34;, zap.Any(\u0026#34;error\u0026#34;, err), zap.String(\u0026#34;request\u0026#34;, string(httpRequest)), ) } c.AbortWithStatus(http.StatusInternalServerError) } }() c.Next() } } è¿æ¥mysql åˆ›å»ºdao/mysql/mysql.go\nå®‰è£…é©±åŠ¨ï¼šgo get -u github.com/go-sql-driver/mysql\nå®‰è£…sqlxï¼š go get github.com/jmoiron/sqlx\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 package mysql import ( \u0026#34;fmt\u0026#34; \u0026#34;github.com/jmoiron/sqlx\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; _ \u0026#34;github.com/go-sql-driver/mysql\u0026#34; ) var db *sqlx.DB func Init() (err error) { dsn := fmt.Sprintf(\u0026#34;%s:%s@tcp(%s:%d)/%s?charset=utf8mb4\u0026amp;parseTime=True\u0026#34;, viper.GetString(\u0026#34;mysql.user\u0026#34;), viper.GetString(\u0026#34;mysql.password\u0026#34;), viper.GetString(\u0026#34;mysql.host\u0026#34;), viper.GetInt(\u0026#34;mysql.port\u0026#34;), viper.GetString(\u0026#34;dbname\u0026#34;)) db, err = sqlx.Connect(\u0026#34;mysql\u0026#34;, dsn) if err != nil { zap.L().Error(\u0026#34;Init Mysql Error\u0026#34;, zap.Error(err)) return } db.SetMaxOpenConns(viper.GetInt(\u0026#34;max_open_conns\u0026#34;)) db.SetMaxIdleConns(viper.GetInt(\u0026#34;max_idle_conns\u0026#34;)) return } func Close() { db.Close() } è¿æ¥redis åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºdao/redis/redis.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 package redis import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/go-redis/redis/v8\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; ) var rdb *redis.Client func Init() (err error) { rdb = redis.NewClient(\u0026amp;redis.Options{ Addr: fmt.Sprintf(\u0026#34;%s:%d\u0026#34;, viper.GetString(\u0026#34;redis.host\u0026#34;), viper.GetInt(\u0026#34;redis.port\u0026#34;)), Password: viper.GetString(\u0026#34;redis.password\u0026#34;), PoolSize: viper.GetInt(\u0026#34;redis.pool_size\u0026#34;), DB: viper.GetInt(\u0026#34;redis.db\u0026#34;), }) _, err = rdb.Ping(context.Background()).Result() return } func Close() { rdb.Close() } é…ç½®è·¯ç”± åˆ›å»ºroutes/routes.go\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 package routes import ( \u0026#34;github.com/gin-gonic/gin\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;web_app/logger\u0026#34; ) func Setup() *gin.Engine { r := gin.New() r.Use(logger.GinLogger(), logger.GinRecovery(true)) r.GET(\u0026#34;/\u0026#34;, func(c *gin.Context) { c.String(http.StatusOK, \u0026#34;ok\u0026#34;) }) return r } é…ç½®ä¸»ç¨‹åº 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;github.com/spf13/viper\u0026#34; \u0026#34;go.uber.org/zap\u0026#34; \u0026#34;net/http\u0026#34; \u0026#34;os\u0026#34; \u0026#34;os/signal\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;time\u0026#34; \u0026#34;web_app/config\u0026#34; \u0026#34;web_app/dao/mysql\u0026#34; \u0026#34;web_app/dao/redis\u0026#34; \u0026#34;web_app/logger\u0026#34; \u0026#34;web_app/routes\u0026#34; ) func main() { //åˆå§‹åŒ–é…ç½® if err := config.Init(); err != nil { fmt.Printf(\u0026#34;Init Config Error,err:%v\\n\u0026#34;, err) return } //åˆå§‹åŒ–æ—¥å¿— if err := logger.Init(); err != nil { fmt.Printf(\u0026#34;Init Logger Error, err:%v\\n\u0026#34;, err) return } defer zap.L().Sync() //åˆå§‹åŒ–sql if err := mysql.Init(); err != nil { fmt.Printf(\u0026#34;Init Mysql Error, err:%v\\n\u0026#34;, err) return } defer mysql.Close() //åˆå§‹åŒ–redis if err := redis.Init(); err != nil { fmt.Printf(\u0026#34;Init Redis Error, err:%v\\n\u0026#34;, err) return } defer redis.Close() r := routes.Setup() srv := \u0026amp;http.Server{ Addr: fmt.Sprintf(\u0026#34;:%d\u0026#34;, viper.GetInt(\u0026#34;app.port\u0026#34;)), Handler: r, } go func() { if err := srv.ListenAndServe(); err != nil \u0026amp;\u0026amp; err != http.ErrServerClosed { zap.L().Fatal(\u0026#34;listen err\u0026#34;, zap.Error(err)) } }() quit := make(chan os.Signal, 1) // kill é»˜è®¤ä¼šå‘é€ syscall.SIGTERM ä¿¡å· // kill -2 å‘é€ syscall.SIGINT ä¿¡å·ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„Ctrl+Cå°±æ˜¯è§¦å‘ç³»ç»ŸSIGINTä¿¡å· // kill -9 å‘é€ syscall.SIGKILL ä¿¡å·ï¼Œä½†æ˜¯ä¸èƒ½è¢«æ•è·ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ å®ƒ // signal.NotifyæŠŠæ”¶åˆ°çš„ syscall.SIGINTæˆ–syscall.SIGTERM ä¿¡å·è½¬å‘ç»™quit signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) \u0026lt;-quit // é˜»å¡åœ¨æ­¤ï¼Œå½“æ¥æ”¶åˆ°ä¸Šè¿°ä¸¤ç§ä¿¡å·æ—¶æ‰ä¼šå¾€ä¸‹æ‰§è¡Œ zap.L().Info(\u0026#34;shutdown server\u0026#34;) ctx, cancelFunc := context.WithTimeout(context.Background(), time.Second*5) defer cancelFunc() // 5ç§’å†…ä¼˜é›…å…³é—­æœåŠ¡ï¼ˆå°†æœªå¤„ç†å®Œçš„è¯·æ±‚å¤„ç†å®Œå†å…³é—­æœåŠ¡ï¼‰ï¼Œè¶…è¿‡5ç§’å°±è¶…æ—¶é€€å‡º if err := srv.Shutdown(ctx); err != nil { zap.L().Fatal(\u0026#34;Server Shutdown:\u0026#34;, zap.Error(err)) } zap.L().Info(\u0026#34;Server exiting\u0026#34;) } åˆ°æ­¤ï¼Œè„šæ‰‹æ¶å°±å…¨éƒ¨æ­å»ºå®Œæˆï¼Œå¯åŠ¨åï¼Œè®¿é—®localhost:8081ï¼Œæ”¶åˆ°è¿”å›çš„okï¼Œè¯´æ˜æ­å»ºæˆåŠŸäº†ã€‚\n","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/go%E8%84%9A%E6%89%8B%E6%9E%B6/","summary":"è„šæ‰‹æ¶æœ‰ä»€ä¹ˆç”¨ è„šæ‰‹æ¶ï¼ˆScaffoldï¼‰æ˜¯ä¸€ç§å¿«é€Ÿæ­å»ºé¡¹ç›®çš„å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜è‡ªåŠ¨åŒ–ç”Ÿæˆé¡¹ç›®çš„åŸºç¡€ç»“æ„å’Œæ–‡ä»¶ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡å’Œå‡å°‘å‡ºé”™","title":"Goè„šæ‰‹æ¶å­¦ä¹ "},{"content":"å®‰è£…é©±åŠ¨ goä¸­database/sqlå·²å°è£…å¥½äº†å®Œæ•´çš„sqlä½¿ç”¨APIï¼Œä½†æ²¡æœ‰é©±åŠ¨ï¼Œéœ€è¦å¯¼å…¥å¯¹åº”æ•°æ®åº“çš„é©±åŠ¨ã€‚\nåœ¨è¿™é‡Œä»¥mysqlä¸ºä¾‹ï¼ŒGo MySQL Driveræ˜¯ Godatabase/sql/driveræ¥å£çš„ä¸€ä¸ªå®ç°ï¼Œåªéœ€å¯¼å…¥é©±åŠ¨ç¨‹åºå³å¯ã€‚\nåœ¨é¡¹ç›®demoç»ˆç«¯ä¸‹è½½é©±åŠ¨ï¼š\ngo get -u github.com/go-sql-driver/mysql\nè¿æ¥æ•°æ®åº“ åŸç”ŸåŒ…ä¸­func Open(driverName, dataSourceName string ) (* DB , error )å‡½æ•°æ‰“å¼€æ•°æ®åº“ï¼Œè¿”å›ä¸€ä¸ªDBå¯¹è±¡ï¼ŒDB æ˜¯ä¸€ä¸ªæ•°æ®åº“å¥æŸ„ï¼Œè¡¨ç¤ºä¸€ä¸ªåŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªåº•å±‚è¿æ¥çš„æ± ã€‚å¤šä¸ª goroutine å¹¶å‘ä½¿ç”¨å®ƒæ˜¯å®‰å…¨çš„ã€‚ã€‚\nå…¶ä¸­dervierNameæŒ‡å®šæ•°æ®åº“åç§°ï¼ŒdataSourceNameä¸ºæ•°æ®æºåç§°ï¼ˆDSNï¼‰ã€‚\nDSNå…¶æ ¼å¼ä¸ºusername:password@protocol(address)/dbname?param=valueï¼Œå…¶ä¸­dbnameä¸ºè¦è¿æ¥çš„åº“åå­—\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 import ( \u0026#34;database/sql\u0026#34; \u0026#34;fmt\u0026#34; _ \u0026#34;github.com/go-sql-driver/mysql\u0026#34; ) //åˆ›å»ºå…¨å±€dbå¯¹è±¡ var db *sql.DB func initDB() (err error) { dsn := \u0026#34;root:123456@tcp(127.0.0.1:3306)/sys?charset=utf8mb4\u0026amp;parseTime=True\u0026#34; db, err = sql.Open(\u0026#34;mysql\u0026#34;, dsn) if err != nil { panic(err) } //pingä¸ºæµ‹è¯•æ˜¯å¦è¿é€šï¼Œç¡®ä¿çœŸæ­£è¿æ¥ä¸Š err = db.Ping() if err != nil { fmt.Printf(\u0026#34;connect failed,err:%v\u0026#34;, err) return } return } func main() { err := initDB() if err != nil { fmt.Printf(\u0026#34;init db failed,err:%v\\n\u0026#34;, err) return } defer db.Close() } åŸºæœ¬ä½¿ç”¨ é€šè¿‡åˆ›å»ºuserè¡¨ï¼ŒåŒä»¥ä¸‹ç»“æ„ï¼Œè¿›è¡ŒCRUD\nåˆ›å»ºuserç»“æ„ä½“\n1 2 3 4 5 type user struct { id int name string age int } Query æŸ¥è¯¢ä¸€è¡Œ func (db * DB ) QueryRow(query string , args ... any ) * Row\nQueryRow æ‰§è¡Œæœ€å¤šè¿”å›ä¸€è¡Œçš„æŸ¥è¯¢ã€‚QueryRow æ€»æ˜¯è¿”å›ä¸€ä¸ªéé›¶å€¼ã€‚é”™è¯¯ä¼šå»¶è¿Ÿåˆ°è°ƒç”¨ Row çš„ Scan æ–¹æ³•æ—¶å‡ºç°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 func queryRow() { var u1 user queryStr := \u0026#34;select * from user where id = ?\u0026#34; row := db.QueryRow(queryStr, 1) err := row.Scan(\u0026amp;u1.id, \u0026amp;u1.name, \u0026amp;u1.age) if err != nil { fmt.Printf(\u0026#34;queryRow error: %v\u0026#34;, err) return } fmt.Println(u1) } æŸ¥è¯¢å¤šè¡Œ func (db * DB ) Query(query string , args ... any ) (* Rows , error )\nQuery æ‰§è¡Œè¿”å›å¤šè¡Œçš„æŸ¥è¯¢\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 func query() { userSlice := make([]user, 0, 2) rows, _ := db.Query(\u0026#34;select * from user\u0026#34;) defer rows.Close() //åœ¨è¿™é‡Œè°ƒç”¨closeæ˜¯å› ä¸ºä¸ç¡®å®šscanæ—¶æ˜¯å¦ä¼šå‡ºé”™ï¼Œå¦‚å‡ºé”™ï¼Œè€Œrowsåˆä¼šä¸€ç›´å ç”¨è¿æ¥ï¼Œæ­¤æ—¶åº”è¯¥å…³é—­ for rows.Next() { var u user err := rows.Scan(\u0026amp;u.id, \u0026amp;u.name, \u0026amp;u.age) if err != nil { fmt.Printf(\u0026#34;query error: %v\u0026#34;, err) continue } userSlice = append(userSlice, u) } fmt.Println(userSlice) } Exec Exec æ‰§è¡ŒæŸ¥è¯¢è€Œä¸è¿”å›ä»»ä½•è¡Œï¼Œæ’å…¥ã€æ›´æ–°å’Œåˆ é™¤æ“ä½œéƒ½ä½¿ç”¨å®ƒã€‚\nExecè¿”å›ä¸€ä¸ªResultå®ä¾‹\n1 2 3 4 5 6 type Result interface { // LastInsertId è¿”å›æ•°æ®åº“ç”Ÿæˆçš„æ•´æ•°,å³ä¸ºè‡ªå¢çš„idã€‚å¹¶éæ‰€æœ‰æ•°æ®åº“éƒ½æ”¯æŒæ­¤åŠŸèƒ½ï¼Œå¹¶ä¸”æ­¤ç±»è¯­å¥çš„è¯­æ³•å„ä¸ç›¸åŒ LastInsertId() ( int64 , error ) // RowsAffected è¿”å›å— æ›´æ–°ã€æ’å…¥æˆ–åˆ é™¤å½±å“çš„è¡Œæ•°ã€‚å¹¶éæ¯ä¸ªæ•°æ®åº“æˆ–æ•°æ®åº“é©±åŠ¨ç¨‹åºéƒ½æ”¯æŒè¿™ä¸€ç‚¹ã€‚ RowsAffected() ( int64 ,é”™è¯¯) }\tæ’å…¥ 1 2 3 4 5 6 7 8 9 10 11 func execInsert() { insertSql := \u0026#34;insert into user(name,age) values(?,?)\u0026#34; insertRes, err := db.Exec(insertSql, \u0026#34;æ±ªæ±ªæ±ªæ±ª\u0026#34;, 24) if err != nil { fmt.Printf(\u0026#34;insert failed, err:%v\u0026#34;, err) return } insertId, _ := insertRes.LastInsertId() //æœ€åæ’å…¥çš„id rowsAffected, _ := insertRes.RowsAffected() //å½±å“çš„è¡Œæ•° fmt.Println(insertId, rowsAffected) } æ›´æ–° 1 2 3 4 5 6 7 8 9 10 func execUpdate() { updateSql := \u0026#34;update user set age = ? where id = ?\u0026#34; res, err := db.Exec(updateSql, 18, 3) if err != nil { fmt.Printf(\u0026#34;update failed, err:%v\u0026#34;, err) return } rowsAffected, _ := res.RowsAffected() fmt.Println(rowsAffected) } åˆ é™¤ 1 2 3 4 5 6 7 8 9 10 func execDelete() { delectSql := \u0026#34;delete from user where id = ?\u0026#34; res, err := db.Exec(delectSql, 1) if err != nil { fmt.Printf(\u0026#34;delete failed, err:%v\u0026#34;, err) return } rowsAffected, _ := res.RowsAffected() fmt.Println(rowsAffected) } é¢„å¤„ç† åœ¨ä»¥ä¸Šè¿™äº›CRUDä¸­ï¼Œä½¿ç”¨çš„éƒ½æ˜¯å³æ—¶SQLï¼Œæ•°æ®åº“æ¥æ”¶åˆ°ä¸€æ¡sqlåï¼Œå…¶æ‰§è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š\nâ€‹\t1.è¯æ³•å’Œè¯­ä¹‰è§£æ\nâ€‹\t2.ä¼˜åŒ– SQL è¯­å¥ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’\nâ€‹\t3.æ‰§è¡Œå¹¶è¿”å›ç»“æœ\nä¸€æ¬¡ç¼–è¯‘ï¼Œä¸€æ¬¡è¿è¡Œï¼Œè€Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä¸€æ¡sqlå…¶å®æ˜¯ä¸€ç›´è¢«åå¤è¿è¡Œçš„ï¼Œå¦‚å•çº¯çš„æŸ¥è¯¢æ“ä½œï¼Œåˆæˆ–è€…æ˜¯sqlä¸­çš„å‚æ•°ä¸åŒï¼Œå…¶ä»–éƒ½ä¸€æ ·ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦ç»å†è¿™æ ·çš„æµç¨‹å»è§£æï¼Œæ— ç–‘ä¼šé™ä½æ•ˆç‡ã€‚\né¢„å¤„ç†é€šè¿‡å°†ä¸€èˆ¬sqlè¯­å¥æ¨¡ç‰ˆåŒ–ï¼Œåšåˆ°ä¸€æ¬¡ç¼–è¯‘ï¼Œå¤šæ¬¡è¿è¡Œï¼Œæé«˜æ•ˆç‡ã€‚\nä½¿ç”¨ä¸‹é¢å‡½æ•°æ¥è¿›è¡Œé¢„å¤„ç†\nfunc (db * DB ) Prepare(query string ) (* Stmt , error )\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 func prepare() { stmt, err := db.Prepare(\u0026#34;select * from user where id = ?\u0026#34;) if err != nil { fmt.Printf(\u0026#34;exec Prepare failed, err:%v\u0026#34;, err) return } var u user err = stmt.QueryRow(4).Scan(\u0026amp;u.id, \u0026amp;u.name, \u0026amp;u.age) if err != nil { fmt.Printf(\u0026#34;queryRow err:%v\u0026#34;, err) return } fmt.Println(u) } å…¶ä»–çš„æ“ä½œä¹Ÿå¤§åŒå°å¼‚ã€‚\näº‹åŠ¡ åœ¨sqlåŒ…ä¸­ï¼Œæœ‰3ä¸ªå…³äºäº‹åŠ¡çš„ä¸»è¦æ–¹æ³•ã€‚\nfunc (db *DB) Begin() (*Tx, error)ï¼šå¼€å¯äº‹åŠ¡\nfunc (tx *Tx) Commit() errorï¼šæäº¤äº‹åŠ¡\nfunc (tx *Tx) Rollback() errorï¼šå›æ»šäº‹åŠ¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func tx() { tx, err := db.Begin() if err != nil { fmt.Printf(\u0026#34;tx begin error : %v\u0026#34;, err) return } updateSql := \u0026#34;update user set age = ? where id = ?\u0026#34; _, err = tx.Exec(updateSql, 38, 2) if err != nil { fmt.Printf(\u0026#34;error:%v\u0026#34;, err) tx.Rollback() return } _, err = tx.Exec(updateSql, 29, 4) if err != nil { fmt.Printf(\u0026#34;error:%v\u0026#34;, err) tx.Rollback() return } tx.Commit() fmt.Println(\u0026#34;ok\u0026#34;) } åŠ å…¥é¢„å¤„ç†çš„äº‹åŠ¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func txPrepare() { tx, err := db.Begin() if err != nil { fmt.Printf(\u0026#34;tx begin error : %v\u0026#34;, err) return } stmt, _ := tx.Prepare(\u0026#34;update user set age = ? where id = ?\u0026#34;) _, err = stmt.Exec(28, 2) if err != nil { fmt.Printf(\u0026#34;error:%v\u0026#34;, err) tx.Rollback() return } _, err = stmt.Exec(22, 4) if err != nil { fmt.Printf(\u0026#34;error:%v\u0026#34;, err) tx.Rollback() return } tx.Commit() fmt.Println(\u0026#34;ok\u0026#34;) } ","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/go%E5%8E%9F%E7%94%9Fsql%E4%BD%BF%E7%94%A8/","summary":"å®‰è£…é©±åŠ¨ goä¸­database/sqlå·²å°è£…å¥½äº†å®Œæ•´çš„sqlä½¿ç”¨APIï¼Œä½†æ²¡æœ‰é©±åŠ¨ï¼Œéœ€è¦å¯¼å…¥å¯¹åº”æ•°æ®åº“çš„é©±åŠ¨ã€‚ åœ¨è¿™é‡Œä»¥mysqlä¸ºä¾‹ï¼ŒGo MySQL","title":"GoåŸç”Ÿsqlä½¿ç”¨"},{"content":"å®‰è£…Hugo æˆ‘ä½¿ç”¨çš„æ˜¯macosç³»ç»Ÿï¼Œç”¨homebrewè¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥å»githubä¸Šå®‰è£…ã€‚\n1 brew install hugo å®‰è£…å®Œååœ¨ç»ˆç«¯è¾“å…¥æŸ¥çœ‹ç‰ˆæœ¬ç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸã€‚\n1 hugo version æˆ‘çš„æ˜¾ç¤ºå¦‚ä¸‹ï¼š\nå®‰è£…å®Œåæ‰¾ä¸€ä¸ªä½ åšå®¢æƒ³å­˜æ”¾çš„ç›®å½•ï¼Œå°±å¯ä»¥å»ºç«™äº†ã€‚\n1 hugo new site myblog å¯¼å…¥ä¸»é¢˜ï¼Œhugoæœ‰å¾ˆå¤šä¸»é¢˜ï¼ŒæŒ‘é€‰ä¸€ä¸ªä½ å–œæ¬¢çš„ï¼Œåœ¨æ–‡ä»¶å†…gitä¸‹æ¥å°±å¯ä»¥äº†ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„PaperMod\n1 2 cd myblog #å…ˆè¿›å…¥æ–‡ä»¶å†… git clone https://github.com/adityatelange/hugo-PaperMod themes/PaperMod --depth=1 #å¯¼å…¥ä¸»é¢˜ åœ¨myblogå†…æ‰¾åˆ°config.tomlé…ç½®æ–‡ä»¶ï¼Œæ‰“å¼€æ¥ï¼ŒåŠ ä¸Štheme = \u0026ldquo;PaperMod\u0026rdquo;ï¼Œæ‰“å¼€ç»ˆç«¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 #è¾“å…¥ï¼š hugo server #è¾“å‡ºï¼š Start building sites â€¦ hugo v0.108.0+extended darwin/arm64 BuildDate=unknown | EN -------------------+----- Pages | 26 Paginator pages | 0 Non-page files | 0 Static files | 6 Processed images | 0 Aliases | 5 Sitemaps | 1 Cleaned | 0 Built in 48 ms Watching for changes in /Users/zzzlin/Documents/myblog/{archetypes,assets,content,data,layouts,static,themes} Watching for config changes in /Users/zzzlin/Documents/myblog/config.toml Environment: \u0026#34;development\u0026#34; Serving pages from memory Running in Fast Render Mode. For full rebuilds on change: hugo server --disableFastRender Web Server is available at http://localhost:1313/ (bind address 127.0.0.1) Press Ctrl+C to stop è¾“å…¥å®Œï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ http://localhost:1313/ ä¾¿å¯ä»¥è¿›å…¥åšå®¢ï¼Œç›®å‰å¹¶æ²¡æœ‰åˆ›å»ºä»€ä¹ˆç¬”è®°ï¼Œæ‰€ä»¥é‡Œé¢å†…å®¹éƒ½æ˜¯ä¸ºç©ºçš„ã€‚\néƒ¨ç½²åˆ°github Pages â€‹\tåœ¨githubåˆ›å»ºä»“åº“ï¼Œä»“åº“åå­—ä¸€å®šæ˜¯ .github.io , è¿™é‡Œçš„å¡«çš„æ˜¯ä½ githubè´¦å·åå­—ï¼ˆåŒ…æ‹¬æ‹¬å·ï¼‰ï¼Œä¸€å®šè¦å¯¹åº”çš„ä¸Šï¼Œå¦åˆ™ä¸ºå‡ºé”™ã€‚\nâ€‹\tåˆ›å»ºå®Œåï¼Œåœ¨myblogç›®å½•ä¸‹ï¼Œä¿®æ”¹config.tomlï¼Œå°†baseURL = \u0026ldquo;https://.github.io/\u0026quot;ï¼Œè¿™æ ·åç»­çš„èµ„æºæ–‡ç« éƒ½ä¼šä»¥è¿™ä¸ªè·¯å¾„å¯»æ‰¾ï¼Œä¿å­˜å®Œï¼Œç»ˆç«¯è¾“å…¥hugoï¼Œæ‰§è¡Œå®Œæ¯•åï¼Œä¼šç”Ÿæˆpublicæ–‡ä»¶å¤¹ï¼Œé‡Œé¢çš„æ–‡ä»¶æˆ‘ä»¬å°†éƒ¨ç½²åˆ°githubã€‚\n1 2 3 4 5 6 cd public git init git remote add origin git@github.com:\u0026lt;\u0026gt;/\u0026lt;\u0026gt;.github.io.git #è¿™é‡Œè¦æ¢æˆä½ çš„ä»“åº“åœ°å€ git add . git commit -m \u0026#39;first commit\u0026#39; git push åšå®Œè¿™äº›ï¼Œpublicæ–‡ä»¶ä¸‹çš„ä¸œè¥¿éƒ½ä¼šä¸Šä¼ åˆ°ä»“åº“é‡Œï¼Œåœ¨ä»“åº“settingsä¸­æ‰¾åˆ°pagesï¼Œå°†sourceè®¾ç½®ä¸º Deploy from a branchï¼Œä¸å‡ºæ„å¤–ï¼Œè¿‡ä¸€ä¼šå°±ä¼šè‡ªåŠ¨éƒ¨ç½²ä¸Šå»äº†ã€‚ ä¿®æ”¹é…ç½®\nä¿®æ”¹config.tomlé…ç½®ï¼Œå’Œåˆ›å»ºæ–‡ç« çš„é…ç½®ï¼Œæ¨èæŒ‰[ç½®é¡¶] hugoåšå®¢æ­å»º | PaperModä¸»é¢˜è¿›è¡Œé…ç½®ã€‚\nåˆ›å»ºç¬”è®° è¿˜æ˜¯å›åˆ°ç»ˆç«¯myblogè·¯å¾„ä¸‹ï¼Œè¾“å…¥hugo new ****.md, åˆ›å»ºåä¸º****çš„markdownæ ¼å¼çš„ç¬”è®°ï¼Œæ‰€æœ‰çš„ç¬”è®°éƒ½ä¼šåœ¨contentç›®å½•ä¸‹ï¼Œæ ¹æ®ä½ çš„éœ€è¦åœ¨contengä¸‹åˆ›å»ºæ–‡ä»¶å¤¹è¿›è¡Œåˆ†ç±»ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œçš„æ˜¯åˆ†ç±»æ˜¯æŠ€æœ¯ã€ç”Ÿæ´»ï¼Œå°±åˆ›å»ºäº†content/post/tech/å’Œcontent/post/lifeã€‚\nåˆ›å»ºå®Œåï¼Œåœ¨ç¬”è®°æœ€ä¸Šæ–¹æœ‰è¿›è¡Œé…ç½®çš„è®¾ç½®ï¼Œdraft: true # æ˜¯å¦ä¸ºè‰ç¨¿ï¼Œè®¾ç½®ä¸ºtrueæ—¶ï¼Œé»˜è®¤ä¸ä¼šæ˜¾ç¤ºï¼Œå¯ä»¥è¾“å…¥hugo server -Dä¾¿å¯åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œå†™å®Œååº”æ”¹ä¸ºfalseã€‚\nå‘å¸ƒæ–°å†™å®Œçš„ç¬”è®° å½“ä½ æƒ³å‘å¸ƒä¸€ç¯‡æ–°çš„ç¬”è®°æˆ–ä¿®æ”¹äº†é…ç½®ï¼ŒåŒæ ·çš„ï¼Œåœ¨myblogç›®å½•ä¸‹ï¼Œè¾“å…¥hugo ï¼Œæ›´æ–°publicæ–‡ä»¶å¤¹\n1 2 3 4 cd public git add . git commit -m \u0026#39;æ³¨é‡Šï¼Œå¦‚å‘å¸ƒ**ç¬”è®°\u0026#39; git push pushå®Œåè¿‡ä¸€ä¼šå°±å¯ä»¥åœ¨githubç«™ç‚¹çœ‹åˆ°ä½ çš„å†…å®¹æ›´æ–°äº†ã€‚\n","permalink":"https://lopzzzzzzzzz.github.io/posts/life/hugo%E5%BB%BA%E7%AB%99/","summary":"å®‰è£…Hugo æˆ‘ä½¿ç”¨çš„æ˜¯macosç³»ç»Ÿï¼Œç”¨homebrewè¿›è¡Œå®‰è£…ï¼Œä¹Ÿå¯ä»¥å»githubä¸Šå®‰è£…ã€‚ 1 brew install hugo å®‰è£…å®Œååœ¨ç»ˆç«¯è¾“å…¥æŸ¥çœ‹ç‰ˆæœ¬ç¡®è®¤æ˜¯å¦å®‰è£…","title":"Hugoå»ºç«™å¹¶éƒ¨ç½²github pages"},{"content":"1. deferçš„æ‰§è¡Œé¡ºåºç±»ä¼¼äºæ ˆï¼Œâ€œåè¿›å…ˆå‡ºâ€ï¼Œä¹Ÿå°±æ˜¯æœ€å…ˆdeferçš„è¯­å¥æœ€åæ‰§è¡Œï¼Œè€Œæœ€ådeferçš„æœ€å…ˆæ‰§è¡Œ 1 2 3 4 5 6 7 8 9 10 func main() { defer fmt.Println(\u0026#34;1\u0026#34;) defer fmt.Println(\u0026#34;2\u0026#34;) defer fmt.Println(\u0026#34;3\u0026#34;) } //æ§åˆ¶å°æ‰“å° 3 2 1 2. deferå’Œreturnçš„å‘ é¦–å…ˆreturnæ“ä½œå¹¶ä¸æ˜¯åŸå­æ“ä½œï¼Œä»–åˆ†ä¸º2æ­¥ï¼šä¸€æ˜¯ç»™è¿”å›å€¼èµ‹å€¼ï¼ŒäºŒæ˜¯returnè¿”å›å€¼ã€‚å¦‚æœå‡½æ•°ä¸­æœ‰deferçš„è¯ï¼Œé‚£ä¹ˆdeferä¼šè¢«å¤¹æ‚åœ¨2æ­¥ä¸­é—´ï¼Œä¹Ÿå°±æ˜¯å…ˆç»™è¿”å›å€¼èµ‹å€¼ï¼Œæ‰§è¡Œdeferï¼Œreturnè¿”å›å€¼ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 func main() { fmt.Println(\u0026#34;åŒ¿åè¿”å›ï¼š\u0026#34;, a()) //5 fmt.Println(\u0026#34;æœ‰åè¿”å›ï¼š\u0026#34;, b()) //6 } // åŒ¿åè¿”å›å€¼ func a() int { x := 5 defer func() { x++ }() return x } // æœ‰åè¿”å›å€¼ func b() (x int) { x = 5 defer func() { x++ }() return x } ä½¿ç”¨åŒ¿åè¿”å›å‡½æ•°ï¼Œæ§åˆ¶å°æ‰“å°çš„æ˜¯5ï¼Œè¿™æ˜¯æ‰§è¡Œreturn xæ—¶ï¼Œé¦–å…ˆå®šä¹‰ è¿”å›å€¼=xï¼ˆéåŒä¸€ä¸ªå˜é‡ï¼‰ï¼Œç„¶åæ‰§è¡Œdefer x++ï¼Œæœ€åreturnè¿”å›å€¼ï¼Œè€Œæ­¤æ—¶è¿”å›å€¼å·²ç»=xï¼Œx++ä¸ä¼šå†å½±å“è¿”å›å€¼äº†ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯5ã€‚\nä½¿ç”¨æœ‰åè¿”å›æ—¶ï¼Œå°±æŒ‡å®šäº†è¿”å›å€¼=xï¼ˆåŒä¸€ä¸ªå˜é‡ï¼Œå†…å­˜åœ°å€ç›¸åŒï¼‰ï¼Œæ‰€ä»¥x++åï¼Œè¿”å›çš„å€¼ä¹Ÿ++äº†ã€‚\n3. deferæ³¨å†Œè¦å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°æ—¶è¯¥å‡½æ•°æ‰€æœ‰çš„å‚æ•°éƒ½éœ€è¦ç¡®å®šå…¶å€¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 func calc(index string, a, b int) int { ret := a + b fmt.Println(index, a, b, ret) return ret } func main() { x := 1 y := 2 defer calc(\u0026#34;AA\u0026#34;, x, calc(\u0026#34;A\u0026#34;, x, y)) x = 10 defer calc(\u0026#34;BB\u0026#34;, x, calc(\u0026#34;B\u0026#34;, x, y)) y = 20 } ç¬¬ä¸€æ¬¡æ³¨å†Œdefer calc(\u0026ldquo;AA\u0026rdquo;, x, calc(\u0026ldquo;A\u0026rdquo;, x, y))æ—¶ï¼Œä¼šæ‰§è¡Œé‡Œé¢çš„calc(\u0026ldquo;A\u0026rdquo;, x, y)ï¼Œæ­¤æ—¶x=1ï¼Œy=2ï¼Œæ‰€ä»¥å…ˆæ‰“å°ï¼Œ\n1 A 1 2 3 äºæ˜¯defer calc(\u0026ldquo;AA\u0026rdquo;, x, calc(\u0026ldquo;A\u0026rdquo;, x, y))ä¸­çš„å‚æ•°è¢«ç¡®å®šï¼Œæ˜¯defer calc(\u0026ldquo;AA\u0026rdquo;, 1, 3)\næ¥ä¸‹æ¥x=10ï¼Œyæ²¡å˜ï¼Œä»ç­‰äº2ï¼Œæ‰§è¡Œdefer calc(\u0026ldquo;BB\u0026rdquo;, x, calc(\u0026ldquo;B\u0026rdquo;, x, y))ï¼Œæ‰§è¡Œcalc(\u0026ldquo;B\u0026rdquo;, x, y)ï¼Œæ‰“å°\n1 B 10 2 12 äºæ˜¯defer calc(\u0026ldquo;BB\u0026rdquo;, x, calc(\u0026ldquo;B\u0026rdquo;, x, y))ä¸­çš„å‚æ•°è¢«ç¡®å®šï¼Œæ˜¯defer calc(\u0026ldquo;BB\u0026rdquo;, 10, 12)\nç„¶åæŒ‰ç…§deferé¡ºåºæ‰§è¡Œï¼Œå…ˆæ‰§è¡Œdefer calc(\u0026ldquo;BB\u0026rdquo;, 10, 12)ï¼Œå†æ‰§è¡Œdefer calc(\u0026ldquo;AA\u0026rdquo;, 1, 3)ï¼Œæ‰€ä»¥æ‰“å°\n1 2 BB 10 12 22 AA 1 3 4 ","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/go%E4%B8%ADdefer%E4%BD%BF%E7%94%A8/","summary":"1. deferçš„æ‰§è¡Œé¡ºåºç±»ä¼¼äºæ ˆï¼Œâ€œåè¿›å…ˆå‡ºâ€ï¼Œä¹Ÿå°±æ˜¯æœ€å…ˆdeferçš„è¯­å¥æœ€åæ‰§è¡Œï¼Œè€Œæœ€ådeferçš„æœ€å…ˆæ‰§è¡Œ 1 2 3 4 5 6 7 8 9 10 func main() { defer fmt.Println(\u0026#34;1\u0026#34;) defer","title":"Goä¸­Deferä½¿ç”¨"},{"content":"åœ¨ä½¿ç”¨forå¾ªç¯ä¿®æ”¹ç»“æ„ä½“åˆ‡ç‰‡ä¸­çš„å€¼æ—¶ï¼Œå‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹æˆåŠŸã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 type Dog struct { name string } func (d *Dog) setNewName(name string) { d.name = name } func main() { d := Dog{ name: \u0026#34;123\u0026#34;, } d1 := Dog{ name: \u0026#34;456\u0026#34;, } d2 := Dog{ name: \u0026#34;789\u0026#34;, } dogSlice := make([]Dog, 0) dogSlice = append(dogSlice, d, d1, d2) for _, dog := range dogSlice { dog.setNewName(\u0026#34;123\u0026#34;) } for _, dog := range dogSlice { fmt.Println(dog) } } ç»“æœåˆ‡ç‰‡ä¸­dogçš„nameå¹¶æ²¡æœ‰å…¨éƒ¨å˜ä¸º123ï¼Œåæ¥æŸ¥èµ„æ–™æ‰çŸ¥é“forå¾ªç¯ä¸­çš„dogå…¶å®æ˜¯ä¸ªå˜é‡ï¼ŒæŒ‡å‘çš„å¹¶ä¸æ˜¯çœŸæ­£çš„dogã€‚\næ‰“å°å…¶åœ°å€å¯¹æ¯”å¯ä»¥çœ‹å‡ºå‹æ ¹å°±ä¸åŒã€‚\n1 2 3 4 5 6 7 for i, dog := range dogSlice { fmt.Printf(\u0026#34;dogåœ°å€ï¼š%p åˆ‡ç‰‡ä¸­dogçš„çœŸæ­£åœ°å€ï¼š%p\\n\u0026#34;, \u0026amp;dog, \u0026amp;(dogSlice[i])) } dogåœ°å€ï¼š0x14000010230 åˆ‡ç‰‡ä¸­dogçš„çœŸæ­£åœ°å€ï¼š0x14000066180 dogåœ°å€ï¼š0x14000010230 åˆ‡ç‰‡ä¸­dogçš„çœŸæ­£åœ°å€ï¼š0x14000066190 dogåœ°å€ï¼š0x14000010230 åˆ‡ç‰‡ä¸­dogçš„çœŸæ­£åœ°å€ï¼š0x140000661a0 è‹¥è¦ä¿®æ”¹åˆ‡ç‰‡ä¸­çš„dogçš„nameï¼Œåº”è¯¥æŒ‰ç…§ä»¥ä¸‹è¿™ä¹ˆå†™ï¼Œæˆ–è€…å°†dogSliceå˜ä¸ºå­˜dogæŒ‡é’ˆçš„åˆ‡ç‰‡ï¼Œ*dogSlice := make([]Dog, 0)\n1 2 3 4 5 6 7 8 9 10 11 for i, _ := range dogSlice { dogSlice[i].setNewName(\u0026#34;123\u0026#34;) } for _, v := range dogSlice { fmt.Println(v) } æ‰“å°å¦‚ä¸‹ï¼š {123} {123} {123} ","permalink":"https://lopzzzzzzzzz.github.io/posts/tech/go%E4%B8%ADfor%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%9D%91/","summary":"åœ¨ä½¿ç”¨forå¾ªç¯ä¿®æ”¹ç»“æ„ä½“åˆ‡ç‰‡ä¸­çš„å€¼æ—¶ï¼Œå‘ç°å¹¶æ²¡æœ‰ä¿®æ”¹æˆåŠŸã€‚ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 type Dog struct { name string } func (d *Dog) setNewName(name string) {","title":"Goä¸­forå¾ªç¯çš„å‘"},{"content":"golangèœé¸Ÿï¼Œåå†œè®¡ç®—æœºç¡•å£«åœ¨è¯»ã€‚\n","permalink":"https://lopzzzzzzzzz.github.io/about/","summary":"golangèœé¸Ÿï¼Œåå†œè®¡ç®—æœºç¡•å£«åœ¨è¯»ã€‚","title":"About Me"}]